name: Policy Gates

on:
  pull_request:
    types: [opened, edited, synchronize, reopened, ready_for_review]

jobs:
  pr-template-gate:
    if: ${{ github.event.pull_request.draft == false }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      - name: Enforce PR description template sections
        env:
          PR_BODY: ${{ github.event.pull_request.body }}
        run: |
          python .github/scripts/pr_template_gate.py

  docs-changelog-gate:
    if: ${{ github.event.pull_request.draft == false }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      - name: Enforce docs/changelog updates for code-impact changes
        env:
          BASE_SHA: ${{ github.event.pull_request.base.sha }}
          HEAD_SHA: ${{ github.event.pull_request.head.sha }}
        run: |
          python .github/scripts/pr_docs_gate.py
